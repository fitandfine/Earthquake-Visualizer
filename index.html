<!doctype html>
color: 'rgba(0,0,0,0.2)',
weight: 0.6,
opacity: 0.9,
fillOpacity: 0.9
});


// build popup content
const time = formatTime(props.time);
const place = props.place || 'Unknown location';
const urlDetail = props.url || '#';


const popupHtml = `
<div style="min-width:180px">
<strong>${place}</strong><br/>
<div class="small">Mag: ${mag} • Depth: ${depth} km</div>
<div class="small">Time: ${time}</div>
<div style="margin-top:6px"><a href="${urlDetail}" target="_blank">More details</a></div>
</div>
`;


circle.bindPopup(popupHtml);


// add to marker cluster layer
markersLayer.addLayer(circle);


// add a heat point: [lat, lon, intensity]
heatPts.push([lat, lon, Math.max(0.1, mag / 8)]);
}


// update heat layer
heatLayer.setLatLngs(heatPts);


// update UI
lastEl.textContent = new Date().toLocaleTimeString();
countEl.textContent = count;


} catch (err) {
console.error('Fetch error', err);
lastEl.textContent = 'Error fetching';
countEl.textContent = '—';
}
}


// Toggle heatmap on/off
function toggleHeatmap() {
if (map.hasLayer(heatLayer)) {
map.removeLayer(heatLayer);
} else {
map.addLayer(heatLayer);
}
}


// Start or restart the auto-refresh timer
function startAutoRefresh() {
if (autoRefreshTimer) clearInterval(autoRefreshTimer);
autoRefreshTimer = setInterval(fetchAndRender, autoRefreshInterval * 1000);
}


// Wire up UI controls
function wireUI() {
document.getElementById('refreshBtn').addEventListener('click', fetchAndRender);
document.getElementById('toggleHeat').addEventListener('click', () => {
toggleHeatmap();